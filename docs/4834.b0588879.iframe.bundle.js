"use strict";(self.webpackChunk_infinite_debugger_react_mui=self.webpackChunk_infinite_debugger_react_mui||[]).push([[4834],{"./src/hooks/Utils.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{jC:function(){return useCacheableData},RO:function(){return useCreate},R2:function(){return useDelete},Db:function(){return useMutation},vc:function(){return usePaginatedRecords},a:function(){return useRecord},PQ:function(){return useUpdate}});var toConsumableArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),regeneratorRuntime=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),constants=__webpack_require__("./src/constants.ts"),APIContext=__webpack_require__("./src/contexts/APIContext.tsx"),usePolling=function usePolling(_ref){var autoSync=_ref.autoSync,errorMessage=_ref.errorMessage,loading=_ref.loading,refreshInterval=_ref.refreshInterval,load=_ref.load,nextSyncTimeoutRef=(0,react.useRef)(null),loadRef=(0,react.useRef)(load);loadRef.current=load,(0,react.useEffect)((function(){if(autoSync&&refreshInterval&&refreshInterval>=1e4&&!loading&&!errorMessage){var blurTime,mouseMoveEventCallback=function mouseMoveEventCallback(){null!==nextSyncTimeoutRef.current&&clearTimeout(nextSyncTimeoutRef.current),nextSyncTimeoutRef.current=setTimeout((function(){loadRef.current()}),refreshInterval)},visiblityChangeEventCallback=function visiblityChangeEventCallback(event){null!==nextSyncTimeoutRef.current&&clearTimeout(nextSyncTimeoutRef.current),window.removeEventListener("mousemove",mouseMoveEventCallback),document.hidden?blurTime=Date.now():(window.addEventListener("mousemove",mouseMoveEventCallback),mouseMoveEventCallback(),event&&null!=blurTime&&Date.now()-blurTime>=6e4&&loadRef.current())};return document.addEventListener("visibilitychange",visiblityChangeEventCallback),visiblityChangeEventCallback(),function(){window.removeEventListener("mousemove",mouseMoveEventCallback),document.removeEventListener("visibilitychange",visiblityChangeEventCallback),null!==nextSyncTimeoutRef.current&&clearTimeout(nextSyncTimeoutRef.current)}}}),[autoSync,errorMessage,loading,refreshInterval])},_excluded=["load","loading","record","loaded","setLoaded"],_excluded2=["mutate","mutating","mutated","setMutated","mutatedRecord"],_excluded3=["create","creating","created","createdRecord","setCreated"],_excluded4=["mutate","mutating","mutated","setMutated","mutatedRecord"],_excluded5=["load","loading","errorMessage","busy","record","setRecord"],_excluded7=["load","loading","errorMessage","record","setRecord"],_excluded8=["load","loading","record","reset","errorMessage","setRecord"],useAPIService=function useAPIService(defaultValue){var loadOnMount=arguments.length>1&&void 0!==arguments[1]&&arguments[1],baseDefaultValue=defaultValue,isComponentMountedRef=(0,react.useRef)(!0),taggedAPIRequestsRef=(0,react.useRef)([]),_useContext=(0,react.useContext)(APIContext.ye),call=_useContext.call,_useState=(0,react.useState)(defaultValue),_useState2=(0,slicedToArray.Z)(_useState,2),record=_useState2[0],setRecord=_useState2[1],_useState3=(0,react.useState)(!1),_useState4=(0,slicedToArray.Z)(_useState3,2),loaded=_useState4[0],setLoaded=_useState4[1],_useState5=(0,react.useState)(loadOnMount),_useState6=(0,slicedToArray.Z)(_useState5,2),loading=_useState6[0],setLoading=_useState6[1],_useState7=(0,react.useState)(!1),_useState8=(0,slicedToArray.Z)(_useState7,2),busy=_useState8[0],setBusy=_useState8[1],_useState9=(0,react.useState)(""),_useState10=(0,slicedToArray.Z)(_useState9,2),errorMessage=_useState10[0],setErrorMessage=_useState10[1],load=(0,react.useCallback)(function(){var _ref=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee2(apiFunction,tag){var polling,taggedAPIRequest,response,_args2=arguments;return(0,regeneratorRuntime.Z)().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(polling=_args2.length>2&&void 0!==_args2[2]&&_args2[2],!apiFunction){_context2.next=13;break}return setErrorMessage(""),setLoaded(!1),setLoading(!0),(taggedAPIRequest=function(){if(tag)return{id:tag,loading:!0}}())&&taggedAPIRequestsRef.current.push(taggedAPIRequest),_context2.next=9,call(apiFunction).then(function(){var _ref2=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(payload){var response;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,payload;case 2:return null!=(response=_context.sent)&&isComponentMountedRef.current&&setRecord(response),isComponentMountedRef.current&&setLoaded(!0),_context.abrupt("return",payload);case 6:case"end":return _context.stop()}}),_callee)})));return function(_x3){return _ref2.apply(this,arguments)}}()).catch((function(err){String(err.message).match(constants.Oj)||polling||setErrorMessage(err.message)}));case 9:return response=_context2.sent,taggedAPIRequest&&taggedAPIRequestsRef.current.includes(taggedAPIRequest)&&taggedAPIRequestsRef.current.splice(taggedAPIRequestsRef.current.indexOf(taggedAPIRequest),1),isComponentMountedRef.current&&setLoading(!1),_context2.abrupt("return",response);case 13:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref.apply(this,arguments)}}(),[call]),resetRef=(0,react.useRef)((function(){setRecord(baseDefaultValue),setLoaded(!1),setLoading(loadOnMount),setBusy(!1),setErrorMessage("")}));return(0,react.useEffect)((function(){return isComponentMountedRef.current=!0,function(){isComponentMountedRef.current=!1}}),[]),{errorMessage:errorMessage,setErrorMessage:setErrorMessage,load:load,loaded:loaded,loading:loading,record:record,setLoaded:setLoaded,setRecord:setRecord,busy:busy,setBusy:setBusy,taggedAPIRequests:taggedAPIRequestsRef.current,reset:resetRef.current}},useMutation=function useMutation(inputMutate){var _useAPIService=useAPIService(null),baseMutate=_useAPIService.load,mutating=_useAPIService.loading,mutatedRecord=_useAPIService.record,mutated=_useAPIService.loaded,setMutated=_useAPIService.setLoaded,rest=(0,objectWithoutProperties.Z)(_useAPIService,_excluded),inputMutateRef=(0,react.useRef)(inputMutate);inputMutateRef.current=inputMutate;var mutate=(0,react.useCallback)((function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return baseMutate((function(){return inputMutateRef.current.apply(inputMutateRef,args)}))}),[baseMutate]);return(0,objectSpread2.Z)({mutate:mutate,mutating:mutating,mutated:mutated,setMutated:setMutated,mutatedRecord:mutatedRecord},rest)},useCreate=function useCreate(inputCreate){var _useMutation=useMutation(inputCreate),create=_useMutation.mutate,creating=_useMutation.mutating,created=_useMutation.mutated,setCreated=_useMutation.setMutated,createdRecord=_useMutation.mutatedRecord,rest=(0,objectWithoutProperties.Z)(_useMutation,_excluded2);return(0,objectSpread2.Z)({create:create,creating:creating,created:created,setCreated:setCreated,createdRecord:createdRecord},rest)},useUpdate=function useUpdate(inputUpdate){var _useCreate=useCreate(inputUpdate),create=_useCreate.create,creating=_useCreate.creating,created=_useCreate.created,createdRecord=_useCreate.createdRecord,setCreated=_useCreate.setCreated,rest=(0,objectWithoutProperties.Z)(_useCreate,_excluded3);return(0,objectSpread2.Z)({update:create,updating:creating,updated:created,updatedRecord:createdRecord,setUpdated:setCreated},rest)},useDelete=function useDelete(inputDelete){var _useMutation2=useMutation(inputDelete),_delete=_useMutation2.mutate,deleting=_useMutation2.mutating,deleted=_useMutation2.mutated,setDeleted=_useMutation2.setMutated,deletedRecord=_useMutation2.mutatedRecord,rest=(0,objectWithoutProperties.Z)(_useMutation2,_excluded4);return(0,objectSpread2.Z)({_delete:_delete,deleting:deleting,deleted:deleted,setDeleted:setDeleted,deletedRecord:deletedRecord},rest)},useRecord=function useRecord(recordFinder){var _ref3=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},defaultValue=_ref3.defaultValue,_ref3$loadOnMount=_ref3.loadOnMount,loadOnMount=void 0===_ref3$loadOnMount||_ref3$loadOnMount,revalidationKey=_ref3.revalidationKey,isInitialMountRef=(0,react.useRef)(!0),recordFinderRef=(0,react.useRef)(recordFinder);recordFinderRef.current=recordFinder;var _useAPIService2=useAPIService(defaultValue,loadOnMount),baseLoad=_useAPIService2.load,loading=_useAPIService2.loading,errorMessage=_useAPIService2.errorMessage,busy=_useAPIService2.busy,record=_useAPIService2.record,setRecord=_useAPIService2.setRecord,rest=(0,objectWithoutProperties.Z)(_useAPIService2,_excluded5),load=(0,react.useCallback)((function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return baseLoad((function(){return recordFinderRef.current?recordFinderRef.current.apply(recordFinderRef,args):Promise.resolve()}))}),[baseLoad]);return(0,react.useEffect)((function(){loadOnMount&&isInitialMountRef.current&&load()}),[load,loadOnMount]),(0,react.useEffect)((function(){!isInitialMountRef.current&&revalidationKey&&load()}),[load,revalidationKey]),(0,react.useEffect)((function(){return isInitialMountRef.current=!1,function(){isInitialMountRef.current=!0}}),[]),(0,objectSpread2.Z)({load:load,loading:loading,errorMessage:errorMessage,record:null!=record?record:null,setRecord:setRecord,busy:busy},rest)},useCacheableData=function useCacheableData(recordFinder){var _ref5=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref5$loadOnMount=_ref5.loadOnMount,loadOnMount=void 0===_ref5$loadOnMount||_ref5$loadOnMount,revalidationKey=_ref5.revalidationKey,isInitialMountRef=(0,react.useRef)(!0),recordFinderRef=(0,react.useRef)(recordFinder);recordFinderRef.current=recordFinder;var pendingDataRequestControllerRef=(0,react.useRef)(null),_useAPIService3=useAPIService(null,loadOnMount),baseLoad=_useAPIService3.load,loading=_useAPIService3.loading,errorMessage=_useAPIService3.errorMessage,record=_useAPIService3.record,setRecord=_useAPIService3.setRecord,rest=(0,objectWithoutProperties.Z)(_useAPIService3,_excluded7),load=(0,react.useCallback)((function(){return baseLoad((0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee3(){var responseData;return(0,regeneratorRuntime.Z)().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!recordFinderRef.current){_context3.next=6;break}return pendingDataRequestControllerRef.current&&(pendingDataRequestControllerRef.current.cancelRequest(),pendingDataRequestControllerRef.current=null),_context3.next=4,recordFinderRef.current({getRequestController:function getRequestController(requestController){pendingDataRequestControllerRef.current=requestController},getStaleWhileRevalidate:function getStaleWhileRevalidate(data){setRecord(data)}}).finally((function(){pendingDataRequestControllerRef.current=null}));case 4:return responseData=_context3.sent,_context3.abrupt("return",responseData);case 6:case"end":return _context3.stop()}}),_callee3)}))))}),[baseLoad,setRecord]);return(0,react.useEffect)((function(){loadOnMount&&isInitialMountRef.current&&load()}),[load,loadOnMount]),(0,react.useEffect)((function(){!isInitialMountRef.current&&revalidationKey&&load()}),[load,revalidationKey]),(0,react.useEffect)((function(){return isInitialMountRef.current=!1,function(){isInitialMountRef.current=!0}}),[]),(0,objectSpread2.Z)({load:load,loading:loading,errorMessage:errorMessage,data:record,setData:setRecord},rest)},usePaginatedRecords=function usePaginatedRecords(recordFinder){var _ref7=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref7$loadOnMount=_ref7.loadOnMount,loadOnMount=void 0===_ref7$loadOnMount||_ref7$loadOnMount,_ref7$limit=_ref7.limit,limit=void 0===_ref7$limit?100:_ref7$limit,_ref7$offset=_ref7.offset,offset=void 0===_ref7$offset?0:_ref7$offset,searchTerm=_ref7.searchTerm,loadedPagesMap=_ref7.loadedPagesMap,revalidationKey=_ref7.revalidationKey,_ref7$autoSync=_ref7.autoSync,autoSync=void 0===_ref7$autoSync||_ref7$autoSync,_ref7$canLoadNextPage=_ref7.canLoadNextPage,canLoadNextPage=void 0===_ref7$canLoadNextPage||_ref7$canLoadNextPage,refreshInterval=_ref7.refreshInterval,isInitialMountRef=(0,react.useRef)(!0),pendingRecordRequestControllers=(0,react.useRef)([]),recordFinderRef=(0,react.useRef)(recordFinder);recordFinderRef.current=recordFinder;var loadedPagesMapRef=(0,react.useRef)(loadedPagesMap);loadedPagesMapRef.current=loadedPagesMap;var recordsTotalCountRef=(0,react.useRef)(0),hasNextPageRef=(0,react.useRef)(!0),limitRef=(0,react.useRef)(limit);limitRef.current=limit;var offsetRef=(0,react.useRef)(offset);offsetRef.current=offset;var searchTermRef=(0,react.useRef)(searchTerm);searchTermRef.current=searchTerm;var allPageRecordsRef=(0,react.useRef)([]),lastLoadedPageRef=(0,react.useRef)(void 0),_useAPIService4=useAPIService(null,loadOnMount),loadFromAPIService=_useAPIService4.load,loading=_useAPIService4.loading,responseData=_useAPIService4.record,errorMessage=(_useAPIService4.reset,_useAPIService4.errorMessage),setRecord=_useAPIService4.setRecord,rest=(0,objectWithoutProperties.Z)(_useAPIService4,_excluded8),loadedPages=(0,react.useMemo)((function(){return loadedPagesMapRef.current||new Map}),[]),load=(0,react.useCallback)((function(){var _params$isLoadingNext,params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(params=(0,objectSpread2.Z)({},params)).offset||(params.offset=offsetRef.current),params.limit||(params.limit=limitRef.current),params.searchTerm||(params.searchTerm=searchTermRef.current),null!==(_params$isLoadingNext=params.isLoadingNextPage)&&void 0!==_params$isLoadingNext||(params.isLoadingNextPage=!1),params.isLoadingNextPage||(lastLoadedPageRef.current=void 0),loadFromAPIService((0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee4(){var localPendingRecordRequestControllers,processResponseData,responseData;return(0,regeneratorRuntime.Z)().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return localPendingRecordRequestControllers=[],processResponseData=function processResponseData(responseData){var isResponsePaginated="records"in responseData&&null!=responseData.recordsTotalCount,paginatedResponseData=Array.isArray(responseData)?{records:responseData,recordsTotalCount:responseData.length,hasNextPage:!1,loadedPageKey:0}:null==responseData.recordsTotalCount?(0,objectSpread2.Z)((0,objectSpread2.Z)({},responseData),{},{hasNextPage:!1,loadedPageKey:0}):responseData,records=paginatedResponseData.records,recordsTotalCount=paginatedResponseData.recordsTotalCount,hasNextPage=paginatedResponseData.hasNextPage,loadedPageKey=paginatedResponseData.loadedPageKey;isResponsePaginated||loadedPages.clear(),loadedPages.set(null!=loadedPageKey?loadedPageKey:params.offset,records),allPageRecordsRef.current=(0,toConsumableArray.Z)(loadedPages.keys()).sort((function(a,b){return a-b})).map((function(key){return loadedPages.get(key)})).flat(),lastLoadedPageRef.current=paginatedResponseData,recordsTotalCountRef.current=null!=recordsTotalCount?recordsTotalCount:records.length,hasNextPageRef.current=null!=hasNextPage?hasNextPage:isResponsePaginated&&allPageRecordsRef.current.length<recordsTotalCountRef.current,setRecord(paginatedResponseData)},_context4.next=4,recordFinderRef.current((0,objectSpread2.Z)((0,objectSpread2.Z)({},params),{},{getRequestController:function getRequestController(requestController){localPendingRecordRequestControllers.push(requestController),pendingRecordRequestControllers.current.push(requestController)},getStaleWhileRevalidate:function getStaleWhileRevalidate(data){processResponseData(data)},lastLoadedPage:lastLoadedPageRef.current})).finally((function(){localPendingRecordRequestControllers.length>0&&localPendingRecordRequestControllers.forEach((function(requestController){pendingRecordRequestControllers.current.indexOf(requestController)&&pendingRecordRequestControllers.current.splice(pendingRecordRequestControllers.current.indexOf(requestController),1)}))}));case 4:return responseData=_context4.sent,params.isLoadingNextPage||(loadedPages.clear(),recordsTotalCountRef.current=0),processResponseData(responseData),_context4.abrupt("return",responseData);case 8:case"end":return _context4.stop()}}),_callee4)}))))}),[loadFromAPIService,loadedPages,setRecord]),loadRef=(0,react.useRef)(load);loadRef.current=load;var loadNextPage=(0,react.useCallback)((function(params){if(canLoadNextPage&&!loading&&hasNextPageRef.current){var lastPageOffset=(0,toConsumableArray.Z)(loadedPages.keys()).sort((function(a,b){return b-a}))[0],lastPageRecords=loadedPages.get(lastPageOffset);lastPageRecords&&null!=lastPageOffset&&load((0,objectSpread2.Z)((0,objectSpread2.Z)({},params),{},{offset:lastPageOffset+lastPageRecords.length,limit:limit||lastPageRecords.length,isLoadingNextPage:!0}))}}),[canLoadNextPage,limit,load,loadedPages,loading]),resetRef=(0,react.useRef)((function(){loadedPages.clear(),recordsTotalCountRef.current=0,hasNextPageRef.current=!0,lastLoadedPageRef.current=void 0;var requestControllersToClear=(0,toConsumableArray.Z)(pendingRecordRequestControllers.current);requestControllersToClear.forEach((function(pendingRecordRequestController){pendingRecordRequestController.cancelRequest()})),requestControllersToClear.forEach((function(pendingRecordRequestController){pendingRecordRequestControllers.current.includes(pendingRecordRequestController)&&pendingRecordRequestControllers.current.splice(pendingRecordRequestControllers.current.indexOf(pendingRecordRequestController),1)}))}));return(0,react.useEffect)((function(){!isInitialMountRef.current&&(limit||searchTerm||revalidationKey)&&resetRef.current()}),[limit,revalidationKey,searchTerm]),(0,react.useEffect)((function(){loadOnMount&&isInitialMountRef.current&&loadRef.current()}),[loadOnMount]),(0,react.useEffect)((function(){!isInitialMountRef.current&&autoSync&&(limit||searchTerm||offset||revalidationKey)&&loadRef.current()}),[autoSync,limit,offset,revalidationKey,searchTerm]),usePolling({load:load,autoSync:autoSync,errorMessage:errorMessage,loading:loading,refreshInterval:refreshInterval}),(0,react.useEffect)((function(){return isInitialMountRef.current=!1,function(){isInitialMountRef.current=!0}}),[]),(0,objectSpread2.Z)({currentPageRecords:loadedPages.get(offset)||[],allPageRecords:allPageRecordsRef.current,recordsTotalCount:recordsTotalCountRef.current,loadedPages:loadedPages,load:load,loading:loading,loadNextPage:loadNextPage,responseData:responseData,reset:resetRef.current,hasNextPage:hasNextPageRef.current,errorMessage:errorMessage},rest)}}}]);