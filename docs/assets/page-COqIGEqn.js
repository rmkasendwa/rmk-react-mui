import{r as u}from"./index-DyFhm7NF.js";import{u as A}from"./index-QOX7K4AL.js";const F=({fileField:d,upload:y,download:h,name:O,id:D,value:b,onChange:x,convertFilesToBase64:U=!0})=>{const[R,r]=u.useState(b||[]),[C,J]=u.useState([]),k=u.useRef(!0),L=u.useRef(x),j=u.useRef(h),z=u.useRef(y),S=u.useRef(R);u.useEffect(()=>{k.current=!1,L.current=x,j.current=h,z.current=y,S.current=R},[h,R,x,y]);const N=u.useRef(l=>l.map(g=>{const f={...g},{originalFile:s,id:c,extraParams:P}=g,o=z.current;if(o){const w=()=>{r(a=>{const e=a.find(({originalFile:n})=>n===s);return e?(e.uploadError="",delete e.retryUpload,Object.assign(e,E()),[...a]):a})},E=()=>{const{cancel:a}=o(s,{onProgress:e=>{r(n=>{const t=n.find(({originalFile:i})=>i===s);return t?(t.uploadProgress=e,[...n]):n})},onError:e=>{r(n=>{const t=n.find(({originalFile:i})=>i===s);return t?(t.uploadError=e.message,t.retryUpload=w,[...n]):n})},onSuccess:e=>{e.id&&r(n=>{const t=n.find(({originalFile:i})=>i===s);return t?(t.id=e.id,[...n]):n})},onComplete:()=>{r(e=>{const n=e.find(({originalFile:t})=>t===s);return n?(n.uploading=!1,[...e]):e})}});r(e=>{const n=e.find(({originalFile:t})=>t===s);return n?(n.uploading=!0,n.cancelUpload=()=>{a(),r(t=>t.includes(n)?(t.splice(t.indexOf(n),1),[...t]):t)},[...e]):e})};f.upload=E}const m=j.current;if(m){const w=()=>{r(a=>{const e=a.find(({id:n})=>n===c);return e?(e.downloadError="",delete e.retryDownload,Object.assign(e,E()),[...a]):a})},E=()=>{const{cancel:a}=m({id:c,extraParams:P},{onProgress:e=>{r(n=>{const t=n.find(({id:i})=>i===c);return t?(t.downloadProgress=e,[...n]):n})},onError:e=>{r(n=>{const t=n.find(({id:i})=>i===c);return t?(t.downloadError=e.message,t.retryDownload=w,[...n]):n})},onSuccess:e=>{e.id&&r(n=>{const t=n.find(({id:i})=>i===c);return t?(t.id=e.id,[...n]):n})},onComplete:()=>{r(e=>{const n=e.find(({id:t})=>t===c);return n?(n.downloading=!1,[...e]):e})}});r(e=>{const n=e.find(({id:t})=>t===c);return n?(n.downloading=!0,n.cancelDownload=()=>{a(),r(t=>{const i=t.find(({id:q})=>q===c);return i?(i.downloading=!1,delete i.downloadError,delete i.downloadProgress,[...t]):t})},[...e]):e})};f.download=E}return f}));return u.useEffect(()=>{if(d){const l=async()=>{if(d.files&&d.files.length>0){const[g,f]=[...d.files].reduce((o,m)=>{const w=S.current.find(({name:E,size:a})=>m.name===E&&m.size===a);return w?o[1].push(S.current.indexOf(w)):o[0].push(m),o},[[],[]]),s=await Promise.all(g.map(o=>{const{name:m,size:w}=o;return U?new Promise((E,a)=>{const e=new FileReader;e.readAsDataURL(o),e.onload=()=>E({base64:e.result,originalFile:o,name:m,size:w}),e.onerror=n=>a(n)}):{originalFile:o,id:A(),name:m,size:w}}));d.value="";const c=N.current(s),P=[...S.current,...c];r(P),J(f),c.forEach(({upload:o})=>{o&&o()})}};return d.addEventListener("change",l),()=>{d.removeEventListener("change",l)}}},[U,d]),u.useEffect(()=>{r(l=>b&&JSON.stringify(b.map(({id:g,name:f,size:s})=>({id:g,name:f,size:s})))!==JSON.stringify(l.map(({id:g,name:f,size:s})=>({id:g,name:f,size:s})))?b:l)},[b]),u.useEffect(()=>{if(L.current&&!k.current){const l=new Event("change",{bubbles:!0});Object.defineProperty(l,"target",{writable:!1,value:{id:D,name:O,value:R.map(({id:g,base64:f,name:s,size:c,originalFile:P,extraParams:o})=>({id:g,base64:f,name:s,size:c,originalFile:P,extraParams:o}))}}),L.current(l)}},[R,D,O]),{files:R,duplicateFileSelections:C,setFiles:r}},G=d=>{d.classList.add("flicker"),setTimeout(()=>d.classList.remove("flicker"),1e3)};export{G as f,F as u};
