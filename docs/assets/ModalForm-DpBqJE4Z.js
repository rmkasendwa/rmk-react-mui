import{j as e}from"./jsx-runtime-DoEZbXM1.js";import{d as le}from"./data-qU85DSPb.js";import{C as de}from"./Close-BjwsHb0e.js";import{c as Oe,e as W,a as v,g as Ve,f as Ge}from"./defaultTheme-p7chgXuo.js";import{i as Qe}from"./Formik-Xq4A1QCi.js";import{p as ce}from"./pick-BJ3H5asV.js";import{r as o}from"./index-DyFhm7NF.js";import{E as ue}from"./ErrorAlert-McfmoKYJ.js";import{F as Ye,f as Je,a as Ke}from"./FormikForm-CQxtv8I0.js";import{S as me,M as Xe}from"./SearchSyncToolbar-BnnCoHC4.js";import{u as Ze}from"./useThemeProps-Bd4KMueQ.js";import{u as et}from"./useTheme-3fQBR54N.js";import{u as tt}from"./dates-CvympFuk.js";import{C as rt}from"./Card-DZM0fdGV.js";import{D as k}from"./List-BTl9Ld56.js";import{B as m}from"./Box-Cv6nAA57.js";import{T as st}from"./Typography-CgOnAQvQ.js";import{G as r}from"./Grid-DBMPafDk.js";import{B as i}from"./Button-UL46O9fT.js";import{A as nt}from"./Alert-B-kYoUC8.js";const ot=w=>Ve("MuiModalForm",w),pe={root:["root"],cardRoot:["cardRoot"],cardBody:["cardBody"]};Ge("MuiModalForm",Object.keys(pe));const fe=(w,he)=>{const xe=Ze({props:w,name:"MuiModalForm"}),{className:H,initialValues:S,validationSchema:ye,FormikProps:ge,children:q,errorMessage:g,successMessage:b,onSubmit:be,onSubmitSuccess:_,title:$,submitted:C=!1,submitButtonText:Ce="Submit",onClose:z,staticEntityDetails:L,editMode:O=!0,showEditButton:Te=!0,showFormActionButtons:je=!0,showForm:B=!0,onClickEdit:V,viewModeTools:G,lockSubmitIfNoChange:ve=!0,lockSubmitIfFormInvalid:ke=!1,CardProps:we={},CardBodyProps:Se={},SubmitButtonProps:qe={},ActionButtonProps:Be={},ActionButtonAreaProps:Me={},SearchSyncToolbarProps:Pe={},showCloseIconButton:Fe=!0,showCloseActionButton:M=!0,loading:p,actionButtons:Q,actionAreaTools:Y,CloseActionButtonProps:Ae={},editableFields:T,placement:J="center",draftManager:f,draft:t,open:P,errorAlertPlacement:K="bottom",...De}=xe,F=Oe(pe,ot,(()=>{if(H)return{root:H}})()),{palette:j,breakpoints:Re,spacing:X}=et(),Ee=tt(Re.down("sm")),{sx:d,...c}=Be,{sx:Z,...ee}=Me,{...Ie}=qe,{sx:te,...re}=Pe,{sx:se,...A}=we,{children:D,sx:R,...E}=Ae,{sx:Ne,...ne}=Se,{CardProps:Ue={}}=(()=>{const n={};switch(J){case"right":case"left":n.CardProps={...A,sx:{maxWidth:600,...se,borderRadius:0,height:"100%",maxHeight:"none"}};break}return n})(),{sx:We,...He}=Ue,I=o.useRef(_);I.current=_;const h=o.useRef(f);h.current=f;const N=o.useRef(!1),[oe,U]=o.useState(!1),s=({saveDraft:n=!1,force:u=!1}={})=>{if(N.current&&!oe&&!u){U(!0);return}if(!n&&h.current&&(t!=null&&t.id)){const{closeDraft:a,deleteDraft:l}=h.current;a(t.id),l(t.id)}N.current=!1,U(!1),z&&z()},ie=o.useRef(s);ie.current=s;const[_e,$e]=o.useState({isDraftLoaded:!1,initialDraft:null}),{isDraftLoaded:ze,initialDraft:ae}=_e;o.useEffect(()=>{if(h.current&&(t!=null&&t.id)&&P){const{openDraft:n,findDraft:u,closeDraft:a}=h.current;return n(t.id),(async()=>{const l=await u(t.id);$e({initialDraft:l,isDraftLoaded:!0})})(),()=>{a(t.id)}}},[t==null?void 0:t.id,P]),o.useEffect(()=>{C&&!b&&(ie.current({force:!0}),I.current&&I.current())},[C,b]);const Le=e.jsx(rt,{...He,...A,className:W(F.root,A.className),sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:640,maxHeight:"80%",...We,...se,[`.${Je.formFieldsWrapper}, .${Ke.root}`]:{display:"flex",flexDirection:"column",flex:1,minHeight:0}},children:e.jsx(Ye,{validationSchema:ye,onSubmit:be,FormikProps:ge,initialValues:ae||S,enableReinitialize:!0,wrapChildrenInForm:O,children:({values:n,isValid:u,...a})=>{const l=!Qe(T&&T.length>0?le.diff(ce(n,T),ce(S,T)):le.diff(n,S));return N.current=l,f&&(t!=null&&t.id)&&ze&&(l||ae)&&f.updateDraft({...t,data:n}),oe?e.jsxs(e.Fragment,{children:[e.jsx(me,{hasSearchTool:!1,hasSyncTool:!1,...re,title:"Confirm",postSyncButtonTools:[{type:"icon-button",label:"Close",icon:e.jsx(de,{}),onClick:()=>s()}],sx:{pr:`${X(2)} !important`,...te}}),e.jsx(k,{}),e.jsx(m,{sx:{py:2,px:3},children:e.jsx(st,{variant:"body2",children:"Please confirm that you want to close this form. All changes that have been made will be discarded."})}),e.jsx(k,{}),e.jsxs(r,{container:!0,spacing:2,...ee,sx:{py:2,px:3,flexDirection:"row-reverse",...Z},children:[e.jsx(r,{item:!0,children:e.jsx(i,{variant:"contained",color:"error",onClick:()=>{s(),a.resetForm()},children:"Close"})}),f&&(t!=null&&t.id)?e.jsx(r,{item:!0,children:e.jsx(i,{variant:"contained",color:"primary",onClick:()=>{s({saveDraft:!0}),a.resetForm()},children:"Save as draft"})}):null,e.jsx(r,{item:!0,children:e.jsx(i,{variant:"text",color:"inherit",onClick:()=>{U(!1)},children:"Cancel"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{hasSearchTool:!1,hasSyncTool:!1,...re,title:$,...(()=>{if(Fe&&!p)return{postSyncButtonTools:[{type:"icon-button",label:"Close",icon:e.jsx(de,{}),onClick:()=>s()}]}})(),sx:{pr:`${X(2)} !important`,...te}}),e.jsx(k,{}),e.jsx(m,{sx:{py:0,px:3},children:L?e.jsx(m,{sx:{...B?{pt:2}:{py:2}},children:L}):null}),(()=>{if(B)return e.jsxs(m,{...ne,className:W(F.cardBody,ne.className),sx:{overflowY:"auto",py:2,px:3,flex:1,position:"relative",...Ne},children:[g&&K==="top"?e.jsx(m,{sx:{pb:2,position:"sticky",top:0,zIndex:5},children:e.jsx(ue,{message:g})}):null,C&&!p&&b?e.jsx(nt,{variant:"filled",severity:"success",onClose:()=>{s({force:!0}),a.resetForm()},children:b}):typeof q=="function"?q({values:n,isValid:u,formHasChanges:l,...a}):q,g&&K==="bottom"?e.jsx(m,{sx:{pt:2,position:"sticky",bottom:0,zIndex:5},children:e.jsx(ue,{message:g})}):null]})})(),e.jsx(k,{}),e.jsxs(r,{container:!0,spacing:2,...ee,sx:{py:2,px:3,...(()=>{if(Ee)return{py:1,px:2}})(),flexDirection:"row-reverse",alignItems:"center",...Z},children:[je?e.jsx(e.Fragment,{children:O?(()=>{if((C||!B)&&!p){if(M)return e.jsx(r,{item:!0,children:e.jsx(i,{variant:"text",color:"inherit",...c,...E,onClick:()=>s(),sx:{color:v(j.text.primary,.5),...d,...R},children:D??"Close"})})}else return e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,children:e.jsx(i,{variant:"contained",...c,...Ie,type:"submit",loading:p,disabled:(()=>{if(ve)return!l;if(ke)return!u})(),sx:d,children:Ce})}),p?null:e.jsx(r,{item:!0,children:e.jsx(i,{variant:"text",color:"inherit",...c,onClick:()=>s(),sx:{color:v(j.text.primary,.5),...d},children:"Cancel"})})]})})():e.jsxs(e.Fragment,{children:[(()=>{if(Te)return e.jsx(r,{item:!0,children:e.jsx(i,{variant:"contained",...c,onClick:()=>{V&&V()},sx:d,children:"Edit"})})})(),(()=>{if(G)return o.Children.toArray(G).map((x,y)=>e.jsx(r,{item:!0,sx:{minWidth:0},children:x},y))})(),(()=>{if(M)return e.jsx(r,{item:!0,children:e.jsx(i,{variant:"text",color:"inherit",...c,...E,onClick:()=>s(),sx:{color:v(j.text.primary,.5),...d,...R},children:D??"Close"})})})()]})}):e.jsxs(e.Fragment,{children:[(()=>{if(Q)return Q.map((x,y)=>e.jsx(r,{item:!0,sx:{minWidth:0},children:x},y))})(),(()=>{if(M)return e.jsx(r,{item:!0,children:e.jsx(i,{variant:"text",color:"inherit",...c,...E,onClick:()=>s(),sx:{color:v(j.text.primary,.5),...d,...R},children:D??"Close"})})})()]}),e.jsx(r,{item:!0,xs:!0}),(()=>{if(Y)return Y.map((x,y)=>e.jsx(r,{item:!0,sx:{minWidth:0},children:x},y))})()]})]})}})});return e.jsx(Xe,{...De,modalElement:Le,title:$,placement:J,open:P,onClose:s,ref:he,className:W(F.root)})},it=o.forwardRef(fe);fe.__docgenInfo={description:"",methods:[],displayName:"BaseModalForm",props:{successMessage:{required:!1,tsType:{name:"string"},description:""},submitted:{required:!1,tsType:{name:"boolean"},description:""},submitButtonText:{required:!1,tsType:{name:"string"},description:""},staticEntityDetails:{required:!1,tsType:{name:"ReactNode"},description:""},editMode:{required:!1,tsType:{name:"boolean"},description:""},showEditButton:{required:!1,tsType:{name:"boolean"},description:""},showFormActionButtons:{required:!1,tsType:{name:"boolean"},description:""},showForm:{required:!1,tsType:{name:"boolean"},description:""},viewModeTools:{required:!1,tsType:{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"},description:""},lockSubmitIfNoChange:{required:!1,tsType:{name:"boolean"},description:"Determines if the submit button should be locked when the user doesn't perform any changes on the form."},lockSubmitIfFormInvalid:{required:!1,tsType:{name:"boolean"},description:"Determines if the submit button should be locked when the form is not valid."},onSubmitSuccess:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onClickEdit:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},SubmitButtonProps:{required:!1,tsType:{name:"Partial",elements:[{name:"ButtonProps"}],raw:"Partial<ButtonProps>"},description:""},editableFields:{required:!1,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Values)[]"},description:""},draftManager:{required:!1,tsType:{name:"DraftsManager"},description:""},draft:{required:!1,tsType:{name:"Pick",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  data: any;
  draftMessage: string;
  lastUpdatedAt: number;
  draftUrl: string;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"data",value:{name:"any",required:!0}},{key:"draftMessage",value:{name:"string",required:!0}},{key:"lastUpdatedAt",value:{name:"number",required:!0}},{key:"draftUrl",value:{name:"string",required:!0}}]}},{name:"union",raw:"'id' | 'draftMessage' | 'draftUrl'",elements:[{name:"literal",value:"'id'"},{name:"literal",value:"'draftMessage'"},{name:"literal",value:"'draftUrl'"}]}],raw:"Pick<Draft, 'id' | 'draftMessage' | 'draftUrl'>"},description:""},errorAlertPlacement:{required:!1,tsType:{name:"union",raw:"'top' | 'bottom'",elements:[{name:"literal",value:"'top'"},{name:"literal",value:"'bottom'"}]},description:""}},composes:["Omit","Pick"]};it.__docgenInfo={description:"",methods:[],displayName:"ModalForm",props:{successMessage:{required:!1,tsType:{name:"string"},description:""},submitted:{required:!1,tsType:{name:"boolean"},description:""},submitButtonText:{required:!1,tsType:{name:"string"},description:""},staticEntityDetails:{required:!1,tsType:{name:"ReactNode"},description:""},editMode:{required:!1,tsType:{name:"boolean"},description:""},showEditButton:{required:!1,tsType:{name:"boolean"},description:""},showFormActionButtons:{required:!1,tsType:{name:"boolean"},description:""},showForm:{required:!1,tsType:{name:"boolean"},description:""},viewModeTools:{required:!1,tsType:{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"},description:""},lockSubmitIfNoChange:{required:!1,tsType:{name:"boolean"},description:"Determines if the submit button should be locked when the user doesn't perform any changes on the form."},lockSubmitIfFormInvalid:{required:!1,tsType:{name:"boolean"},description:"Determines if the submit button should be locked when the form is not valid."},onSubmitSuccess:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onClickEdit:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},SubmitButtonProps:{required:!1,tsType:{name:"Partial",elements:[{name:"ButtonProps"}],raw:"Partial<ButtonProps>"},description:""},editableFields:{required:!1,tsType:{name:"Array",elements:[{name:"unknown"}],raw:"(keyof Values)[]"},description:""},draftManager:{required:!1,tsType:{name:"DraftsManager"},description:""},draft:{required:!1,tsType:{name:"Pick",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  data: any;
  draftMessage: string;
  lastUpdatedAt: number;
  draftUrl: string;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"data",value:{name:"any",required:!0}},{key:"draftMessage",value:{name:"string",required:!0}},{key:"lastUpdatedAt",value:{name:"number",required:!0}},{key:"draftUrl",value:{name:"string",required:!0}}]}},{name:"union",raw:"'id' | 'draftMessage' | 'draftUrl'",elements:[{name:"literal",value:"'id'"},{name:"literal",value:"'draftMessage'"},{name:"literal",value:"'draftUrl'"}]}],raw:"Pick<Draft, 'id' | 'draftMessage' | 'draftUrl'>"},description:""},errorAlertPlacement:{required:!1,tsType:{name:"union",raw:"'top' | 'bottom'",elements:[{name:"literal",value:"'top'"},{name:"literal",value:"'bottom'"}]},description:""}},composes:["Omit","Pick"]};export{it as M};
