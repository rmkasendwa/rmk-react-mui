import{j as e}from"./jsx-runtime-DoEZbXM1.js";import"./String-3Y7uMP2t.js";import{d as se}from"./index-BeW276Wi.js";import{r as ae}from"./index-USwyTnuU.js";import{c as oe,e as ie,g as le,f as de}from"./defaultTheme-p7chgXuo.js";import{r as s}from"./index-DyFhm7NF.js";import{q as me,r as ce,T as pe,P as ue,c as he}from"./SearchSyncToolbar-BnnCoHC4.js";import"./APIContext-CE3_laQ6.js";import{P as H}from"./ProfileGravatar-_7vuCVIY.js";import{T as ge,P as fe}from"./Tooltip-DvI5SBDW.js";import{u as xe}from"./useThemeProps-Bd4KMueQ.js";import{G as o}from"./Grid-DBMPafDk.js";import{T as j,t as ye}from"./Typography-CgOnAQvQ.js";import{B as G}from"./Box-Cv6nAA57.js";import{C as Pe}from"./Chip-Di80TdUA.js";import{C as Re}from"./Card-DZM0fdGV.js";import{G as Ee}from"./Grow-CmgiTL0Y.js";import{C as Se}from"./ClickAwayListener-C4Bzfge9.js";import{D as ve}from"./List-BTl9Ld56.js";import{C as je}from"./Container-DGDyhXWn.js";import"./jsx-runtime-Bw5QeaCk.js";import"./createSvgIcon-7wHsQNqo.js";import"./SvgIcon-BsgOx8W1.js";import"./DefaultPropsProvider-egKEaGQO.js";import"./Button-UL46O9fT.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./TransitionGroupContext-DDx4AGHL.js";import"./ButtonBase-DE0LPmTn.js";import"./useForkRef-CH5D7H94.js";import"./CircularProgress-D8lStaeO.js";import"./omit-DFcfYKFM.js";import"./_baseGet-DhYokzhK.js";import"./index-Bf2qc8Rt.js";import"./ReloadIconButton-B48KoK_S.js";import"./Refresh-CRz1rqFY.js";import"./ErrorAlert-McfmoKYJ.js";import"./useTheme-3fQBR54N.js";import"./styled-DnokggUK.js";import"./extendSxProp-DAcN17IG.js";import"./IconButton-A2NwtEd5.js";import"./Alert-B-kYoUC8.js";import"./useSlot-By0F5cUN.js";import"./Paper-DGLpRXPs.js";import"./constants-DkQff0yi.js";import"./InfiniteScrollBox-lWcthrSh.js";import"./Close-BjwsHb0e.js";import"./LoadingContext-BtWGSAhI.js";import"./ErrorSkeleton-BVzoEatx.js";import"./FieldLabel-DdtaNqXB.js";import"./LoadingTypography-D6ofm9jy.js";import"./Formik-Xq4A1QCi.js";import"./dates-CvympFuk.js";import"./endOfMonth-DQe_4K7C.js";import"./GlobalConfigurationContext-CqlJy_iX.js";import"./DatePicker-DnCj008b.js";import"./index-Dri-WRqF.js";import"./index-Z2fzZyFz.js";import"./Modal-CXhXU4--.js";import"./utils-DsEKjbah.js";import"./createChainedFunction-BO_9K8Jh.js";import"./Portal-CG3BG1Jq.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./FormHelperText-Bu3IRHZZ.js";import"./isMuiElement-CXq9i0-O.js";import"./index-DwZPt9kI.js";import"./paths-81WlYTGB.js";import"./index-CrueqoMl.js";import"./___vite-browser-external_commonjs-proxy-Ctkxpam9.js";import"./ProfileAvatar-DgyO2HDb.js";import"./Avatar-Cmpc5D-G.js";const qe=i=>le("MuiEmailAddressSelector",i),Y={root:["root"]};de("MuiEmailAddressSelector",Object.keys(Y));const B=50,L=s.forwardRef(function(f,q){const A=xe({props:f,name:"MuiEmailAddressSelector"}),{className:x,startAdornment:y,endAdornment:O,onChangeSelectedEmailAddresses:C,emailAddresses:P,getEmailAddressHolders:c,ProfileGravatarProps:ee={},...te}=A,re=oe(Y,qe,(()=>{if(x)return{root:x}})()),{...b}=ee,[l,I]=s.useState(""),{load:N,allPageRecords:p,reset:k}=me(async({limit:t,offset:n,getRequestController:r})=>{if(c){const a=await c({searchTerm:l,limit:t,offset:n,getRequestController:r});return{records:a,recordsTotalCount:a.length}}return{records:[],recordsTotalCount:0}},{revalidationKey:c==null?void 0:c.toString(),loadOnMount:!1,autoSync:!1,limit:11,searchTerm:l}),R=s.useRef(!0),m=s.useRef(null),z=s.useRef(null),w=s.useRef(C),M=s.useRef(p);s.useEffect(()=>{w.current=C,M.current=p},[p,C]);const[E,T]=s.useState([]),[S,U]=s.useState(void 0),[W,F]=s.useState(!1);s.useEffect(()=>{S&&(T(t=>{const n=M.current.find(({email:r})=>r===S);return[...t,n||S]}),U(void 0))},[S]),s.useEffect(()=>{!R.current&&P&&T(t=>{const n=t.map(r=>typeof r=="string"?r:r.email);return P.join(";")!==n.join(";")?P.map(r=>{const a=t.find(d=>typeof d!="string"&&d.email===r);return a||r}):t})},[P]),s.useEffect(()=>{k(),W&&l.length>0&&N()},[W,N,k,l.length]),s.useEffect(()=>{R.current||w.current&&w.current(E.map(t=>typeof t=="string"?t:t.email))},[E]),s.useEffect(()=>(R.current=!1,()=>{R.current=!0}),[]);const D=ce().email().required().isValidSync(l)?l:void 0,_=[...p,...D?[D]:[]].map(t=>{const{email:n,name:r,profilePictureUrl:a}=typeof t=="string"?{email:t}:t,d=E.map(u=>typeof u=="string"?u:u.email);return{label:e.jsxs(o,{container:!0,spacing:1,sx:{height:B},children:[e.jsx(o,{item:!0,children:e.jsx(H,{...b,size:32,email:n,label:r,src:a})}),e.jsxs(o,{item:!0,xs:!0,sx:{minWidth:0},children:[e.jsx(j,{variant:"body2",noWrap:!0,sx:{fontWeight:600},children:r||n}),e.jsx(j,{variant:"body2",noWrap:!0,sx:{fontSize:12},children:n})]})]}),value:n,selectable:!d.includes(n)}}),ne=!!((D||p.length>0)&&W&&_.length>0&&l.length>0);return e.jsxs(G,{ref:q,...te,className:ie(re.root),children:[e.jsxs(o,{container:!0,sx:{gap:1,mb:1,[`&,.${ye.root}`]:{lineHeight:"32px"}},children:[y?e.jsx(o,{item:!0,sx:{display:"flex",alignItems:"start"},children:e.jsx(G,{sx:{height:32},children:y})}):null,e.jsx(o,{item:!0,xs:!0,sx:{minWidth:0},children:e.jsxs(o,{container:!0,sx:{gap:1},children:[E.map((t,n)=>{const{email:r,name:a,profilePictureUrl:d}=typeof t=="string"?{email:t}:t;return e.jsx(Pe,{avatar:e.jsx(ge,{title:e.jsx(Re,{sx:{p:2,width:360},children:e.jsxs(o,{container:!0,spacing:2,sx:{alignItems:"center"},children:[e.jsx(o,{item:!0,children:e.jsx(H,{...b,size:64,email:r,label:a,src:d})}),e.jsxs(o,{item:!0,xs:!0,sx:{minWidth:0},children:[e.jsx(j,{variant:"body2",noWrap:!0,sx:{fontWeight:600,fontSize:20},children:a||r}),e.jsx(j,{variant:"body2",noWrap:!0,sx:{fontSize:18},children:r})]})]})}),enterDelay:1e3,enterNextDelay:500,componentsProps:{tooltip:{sx:{p:0,maxWidth:"none"}}},children:e.jsx(H,{...b,email:r,label:a,src:d,size:24})}),label:a||r,onDelete:()=>{T(u=>{const v=[...u];return v.includes(t)&&v.splice(v.indexOf(t),1),v})},sx:{height:32}},n)}),e.jsxs(o,{item:!0,xs:!0,children:[e.jsx(pe,{variant:"standard",slotProps:{input:{disableUnderline:!0,sx:{input:{height:32,p:0}},ref:m},htmlInput:{ref:z,onFocus:()=>{F(!0)},onBlur:()=>{F(!1)},sx:{minWidth:80}}},enableLoadingState:!1,value:l,onChange:t=>{I(t.target.value)},showClearButton:!1}),e.jsx(fe,{open:ne,anchorEl:m.current,transition:!0,placement:"bottom-start",sx:{zIndex:9999},children:({TransitionProps:t})=>e.jsx(Ee,{...t,style:{transformOrigin:"0 0 0"},children:e.jsx(G,{children:e.jsx(Se,{onClickAway:n=>{m.current&&F(he(m.current,n.target))},children:e.jsx(ue,{options:_,onSelectOption:({value:n})=>{U(String(n)),I("")},keyboardFocusElement:z.current,minWidth:m.current?m.current.offsetWidth:void 0,optionHeight:B,showNoOptionsFoundMessage:!1})})})})})]})]})}),O?e.jsx(o,{item:!0,sx:{display:"flex",alignItems:"end"},children:O}):null]}),e.jsx(ve,{})]})});L.__docgenInfo={description:"",methods:[],displayName:"EmailAddressSelector",props:{startAdornment:{required:!1,tsType:{name:"ReactNode"},description:""},endAdornment:{required:!1,tsType:{name:"ReactNode"},description:""},emailAddresses:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onChangeSelectedEmailAddresses:{required:!1,tsType:{name:"signature",type:"function",raw:"(emailAddresses: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"emailAddresses"}],return:{name:"void"}}},description:""},getEmailAddressHolders:{required:!1,tsType:{name:"signature",type:"function",raw:`(
  options: PaginatedRecordsFinderOptions
) => Promise<EmailAddressHolder[]>`,signature:{arguments:[{type:{name:"intersection",raw:`PaginatedRequestParams & {
  /**
   * Function that can be used to retrieve the request controller of the data request.
   *
   * @param controller The request controller that can be used to cancel the request.
   */
  getRequestController?: (controller: RecordFinderRequestController) => void;

  /**
   * Function that can be used to retrieve stale data while the request is being made.
   */
  getStaleWhileRevalidate?: GetStaleWhileRevalidateFunction<any>;

  /**
   * The last loaded page.
   */
  lastLoadedPage?: ResponsePage<any, PaginatedResponseDataExtensions>;

  /**
   * Whether the request is loading the next page.
   */
  isLoadingNextPage?: boolean;
}`,elements:[{name:"PaginatedRequestParams"},{name:"signature",type:"object",raw:`{
  /**
   * Function that can be used to retrieve the request controller of the data request.
   *
   * @param controller The request controller that can be used to cancel the request.
   */
  getRequestController?: (controller: RecordFinderRequestController) => void;

  /**
   * Function that can be used to retrieve stale data while the request is being made.
   */
  getStaleWhileRevalidate?: GetStaleWhileRevalidateFunction<any>;

  /**
   * The last loaded page.
   */
  lastLoadedPage?: ResponsePage<any, PaginatedResponseDataExtensions>;

  /**
   * Whether the request is loading the next page.
   */
  isLoadingNextPage?: boolean;
}`,signature:{properties:[{key:"getRequestController",value:{name:"signature",type:"function",raw:"(controller: RecordFinderRequestController) => void",signature:{arguments:[{type:{name:"RecordFinderRequestController"},name:"controller"}],return:{name:"void"}},required:!1},description:`Function that can be used to retrieve the request controller of the data request.

@param controller The request controller that can be used to cancel the request.`},{key:"getStaleWhileRevalidate",value:{name:"signature",type:"function",raw:"(data: Data) => void",signature:{arguments:[{type:{name:"any"},name:"data"}],return:{name:"void"}},required:!1},description:"Function that can be used to retrieve stale data while the request is being made."},{key:"lastLoadedPage",value:{name:"intersection",raw:"PaginatedResponseData<DataRow> & PaginatedResponseDataExtensions",elements:[{name:"PaginatedResponseData",elements:[{name:"any"}],raw:"PaginatedResponseData<DataRow>"},{name:"PaginatedResponseDataExtensions"}],required:!1},description:"The last loaded page."},{key:"isLoadingNextPage",value:{name:"boolean",required:!1},description:"Whether the request is loading the next page."}]}}]},name:"options"}],return:{name:"Promise",elements:[{name:"Array",elements:[{name:"EmailAddressHolder"}],raw:"EmailAddressHolder[]"}],raw:"Promise<EmailAddressHolder[]>"}}},description:""},ProfileGravatarProps:{required:!1,tsType:{name:"ProfileGravatarProps"},description:""}},composes:["Partial"]};const _t={title:"Components/Email Address Selector",component:L},Ae=new se.LoremIpsum,Z=i=>e.jsx(je,{maxWidth:"lg",sx:{p:3},children:e.jsx(L,{...i})}),h=Z.bind({});h.args={startAdornment:"To"};const Ce=Array.from({length:50}).map(()=>{const i=ae();return{name:Ae.generateWords(2),email:i}}),g=Z.bind({});g.args={startAdornment:"To",getEmailAddressHolders:async({searchTerm:i,offset:f=0,limit:q=10})=>Ce.filter(({email:A,name:x})=>[A,x].some(y=>String(y).toLowerCase().match(String(i).toLowerCase()))).slice(f,f+q)};var $,K,V;h.parameters={...h.parameters,docs:{...($=h.parameters)==null?void 0:$.docs,source:{originalSource:`props => <Container maxWidth="lg" sx={{
  p: 3
}}>
    <EmailAddressSelector {...props} />
  </Container>`,...(V=(K=h.parameters)==null?void 0:K.docs)==null?void 0:V.source}}};var J,Q,X;g.parameters={...g.parameters,docs:{...(J=g.parameters)==null?void 0:J.docs,source:{originalSource:`props => <Container maxWidth="lg" sx={{
  p: 3
}}>
    <EmailAddressSelector {...props} />
  </Container>`,...(X=(Q=g.parameters)==null?void 0:Q.docs)==null?void 0:X.source}}};const Bt=["Default","WithEmailAddressSearchPool"];export{h as Default,g as WithEmailAddressSearchPool,Bt as __namedExportsOrder,_t as default};
